<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <title>Ajouter une recette</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @media (max-width: 600px) {
            .container {
                padding: 0.5rem !important;
            }
            h1 {
                font-size: 1.3rem;
            }
            .form-label {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body class="container py-4">
    {% include 'navbar.html' %}
    <h1 class="mb-4">Ajouter une nouvelle recette</h1>
    <form method="POST" enctype="multipart/form-data">
        <!-- Nom de la recette -->
        <div class="mb-3">
            <label class="form-label">Nom de la recette</label>
            <input type="text" name="nom" class="form-control" placeholder="Nom de la recette" required>
        </div>
        <!-- Ingrédients à l'unité -->
        <div class="mb-3">
            <label class="form-label">Ajouter un ingrédient à l'unité</label>
            <div class="input-group mb-2">
                <input type="text" id="ingredient-unite-nom" class="form-control" placeholder="Nom de l'ingrédient" list="ingredient-choices-unite">
                <datalist id="ingredient-choices-unite">
                    {% for nom, unite in ingredient_choices_unite %}
                        <option value="{{ nom }}">{{ nom }}</option>
                    {% endfor %}
                </datalist>
                <input type="number" id="ingredient-unite-quantite" class="form-control" placeholder="Quantité">
                <button type="button" class="btn btn-outline-success" onclick="addIngredientUnite()">Ajouter</button>
            </div>
            <ul id="ingredients-unite-list" class="list-group mb-3"></ul>
        </div>
        <input type="hidden" name="ingredients_unite_json" id="ingredients-unite-json">

        <!-- Ingrédients en quantité -->
        <div class="mb-3">
            <label class="form-label">Ajouter un ingrédient en quantité</label>
            <div class="input-group mb-2">
                <input type="text" id="ingredient-quantite-nom" class="form-control" placeholder="Nom de l'ingrédient" list="ingredient-choices-quantite">
                <datalist id="ingredient-choices-quantite">
                    {% for nom, unite in ingredient_choices_quantite %}
                        <option value="{{ nom }}" data-unite="{{ unite }}">{{ nom }} ({{ unite }})</option>
                    {% endfor %}
                </datalist>
                <input type="number" id="ingredient-quantite-quantite" class="form-control" placeholder="Quantité">
                <input type="text" id="ingredient-quantite-unite" class="form-control" placeholder="Unité">
                <button type="button" class="btn btn-outline-success" onclick="addIngredientQuantite()">Ajouter</button>
            </div>
            <ul id="ingredients-quantite-list" class="list-group mb-3"></ul>
        </div>
        <input type="hidden" name="ingredients_quantite_json" id="ingredients-quantite-json">
        <!-- Photo du plat -->
        <div class="mb-3">
            <label class="form-label">Photo du plat</label>
            <input type="file" name="photo" class="form-control" accept="image/*">
        </div>
        <!-- Notes -->
        <div class="mb-3">
            <label class="form-label">Notes personnelles</label>
            <textarea name="notes" class="form-control" rows="3" placeholder="Notes"></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Ajouter</button>
    </form>
    <script>
    // Ingrédients à l'unité
    let ingredientsUnite = [];
    function addIngredientUnite() {
        const nom = document.getElementById('ingredient-unite-nom').value.trim();
        const quantite = document.getElementById('ingredient-unite-quantite').value.trim();
        if (nom && quantite) {
            ingredientsUnite.push({nom: nom, quantite: quantite});
            updateIngredientsUniteList();
            document.getElementById('ingredient-unite-nom').value = '';
            document.getElementById('ingredient-unite-quantite').value = '';
        }
    }
    function updateIngredientsUniteList() {
        const list = document.getElementById('ingredients-unite-list');
        list.innerHTML = '';
        ingredientsUnite.forEach((ing, idx) => {
            const li = document.createElement('li');
            li.className = 'list-group-item d-flex justify-content-between align-items-center';
            li.innerHTML = `${ing.nom} : ${ing.quantite} <button type='button' class='btn btn-sm btn-danger' onclick='removeIngredientUnite(${idx})'>Supprimer</button>`;
            list.appendChild(li);
        });
        document.getElementById('ingredients-unite-json').value = JSON.stringify(ingredientsUnite);
    }
    function removeIngredientUnite(idx) {
        ingredientsUnite.splice(idx, 1);
        updateIngredientsUniteList();
    }

    // Ingrédients en quantité
    let ingredientsQuantite = [];
    // Ajout auto de l'unité pour ingrédients en quantité
    document.getElementById('ingredient-quantite-nom').addEventListener('input', function(e) {
        const val = e.target.value;
        const options = document.getElementById('ingredient-choices-quantite').options;
        for (let i = 0; i < options.length; i++) {
            if (options[i].value === val) {
                document.getElementById('ingredient-quantite-unite').value = options[i].getAttribute('data-unite');
                break;
            }
        }
    });
    function addIngredientQuantite() {
        const nom = document.getElementById('ingredient-quantite-nom').value.trim();
        const quantite = document.getElementById('ingredient-quantite-quantite').value.trim();
        const unite = document.getElementById('ingredient-quantite-unite').value.trim();
        if (nom && quantite && unite) {
            ingredientsQuantite.push({nom: nom, quantite: quantite, unite: unite});
            updateIngredientsQuantiteList();
            document.getElementById('ingredient-quantite-nom').value = '';
            document.getElementById('ingredient-quantite-quantite').value = '';
            document.getElementById('ingredient-quantite-unite').value = '';
        }
    }
    function updateIngredientsQuantiteList() {
        const list = document.getElementById('ingredients-quantite-list');
        list.innerHTML = '';
        ingredientsQuantite.forEach((ing, idx) => {
            const li = document.createElement('li');
            li.className = 'list-group-item d-flex justify-content-between align-items-center';
            li.innerHTML = `${ing.nom} : ${ing.quantite} ${ing.unite} <button type='button' class='btn btn-sm btn-danger' onclick='removeIngredientQuantite(${idx})'>Supprimer</button>`;
            list.appendChild(li);
        });
        document.getElementById('ingredients-quantite-json').value = JSON.stringify(ingredientsQuantite);
    }
    function removeIngredientQuantite(idx) {
        ingredientsQuantite.splice(idx, 1);
        updateIngredientsQuantiteList();
    }
    </script>
</body>
</html>


